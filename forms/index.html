<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Associate Attorney - Help with filling out forms</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <h1 class="text-3xl font-bold mb-8">AI Associate Attorney - Legal Forms</h1>
    
    <div class="mb-8 flex flex-wrap gap-4">
        <div class="w-full md:w-64">
            <label for="search" class="block text-sm font-medium text-gray-700 mb-2">Search Forms</label>
            <input type="text" id="search" placeholder="Search forms..." class="w-full p-2 border rounded-md">
        </div>
        
        <div class="w-full md:w-64">
            <label for="jurisdiction" class="block text-sm font-medium text-gray-700 mb-2">Jurisdiction</label>
            <select id="jurisdiction" class="w-full p-2 border rounded-md">
                <option value="">Select Jurisdiction</option>
            </select>
        </div>
        
        <div class="w-full md:w-64">
            <label for="area" class="block text-sm font-medium text-gray-700 mb-2">Area of Law</label>
            <select id="area" class="w-full p-2 border rounded-md" disabled>
                <option value="">Select Area</option>
            </select>
        </div>
    </div>

    <!-- Forms List -->
    <div id="formsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Forms will be dynamically inserted here -->
    </div>

    <!-- Form Filler Modal -->
    <div id="formFillerModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="bg-white w-full max-w-6xl h-[90vh] rounded-lg shadow-xl flex">
            <!-- PDF Preview -->
            <div class="w-1/2 h-full border-r">
                <div class="h-16 px-6 flex items-center justify-between border-b">
                    <h3 class="font-semibold text-lg" id="formName"></h3>
                    <button onclick="closeFormFiller()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="h-[calc(90vh-4rem)] p-4">
                    <iframe id="pdfViewer" class="w-full h-full border rounded"></iframe>
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div class="w-1/2 h-full flex flex-col">
                <div class="h-16 px-6 flex items-center border-b">
                    <h3 class="font-semibold">Chat with AI Assistant</h3>
                </div>
                <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <!-- Messages will be inserted here -->
                </div>
                <div class="border-t p-4">
                    <div class="flex gap-2">
                        <input type="text" id="userInput" 
                               class="flex-1 border rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Type your message...">
                        <button onclick="sendMessage()" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function loadFormsData() {
            try {
                const response = await fetch('forms_list.json');
                const data = await response.json();
                initializeSelectors(data);
                displayAllForms(data);
            } catch (error) {
                console.error('Error loading forms:', error);
                document.getElementById('formsList').innerHTML = 
                    '<p class="text-red-600">Error loading forms. Please try again later.</p>';
            }
        }

        function initializeSelectors(data) {
            const jurisdictionSelect = document.getElementById('jurisdiction');
            const areaSelect = document.getElementById('area');
            
            // Populate jurisdictions
            Object.keys(data.jurisdictions).forEach(jurisdiction => {
                const option = document.createElement('option');
                option.value = jurisdiction;
                option.textContent = jurisdiction.charAt(0).toUpperCase() + jurisdiction.slice(1);
                jurisdictionSelect.appendChild(option);
            });

            // Handle jurisdiction change
            jurisdictionSelect.addEventListener('change', () => {
                const selectedJurisdiction = jurisdictionSelect.value;
                updateAreaSelect(data, selectedJurisdiction);
            });

            // Handle area change
            areaSelect.addEventListener('change', () => {
                const selectedJurisdiction = jurisdictionSelect.value;
                const selectedArea = areaSelect.value;
                displayForms(data, selectedJurisdiction, selectedArea);
            });

            // Handle search input
            const searchInput = document.getElementById('search');
            searchInput.addEventListener('input', () => {
                const selectedJurisdiction = jurisdictionSelect.value;
                const selectedArea = areaSelect.value;
                const searchTerm = searchInput.value.toLowerCase();
                
                if (selectedJurisdiction && selectedArea) {
                    displayForms(data, selectedJurisdiction, selectedArea, searchTerm);
                } else {
                    displayAllForms(data, searchTerm);
                }
            });
        }

        function updateAreaSelect(data, jurisdiction) {
            const areaSelect = document.getElementById('area');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            
            if (jurisdiction) {
                const areas = Object.keys(data.jurisdictions[jurisdiction].areas);
                areas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area.split('-').map(word => 
                        word.charAt(0).toUpperCase() + word.slice(1)
                    ).join(' ');
                    areaSelect.appendChild(option);
                });
                areaSelect.disabled = false;
            } else {
                areaSelect.disabled = true;
            }
            
            document.getElementById('formsList').innerHTML = '';
        }

        function displayForms(data, jurisdiction, area) {
            const formsList = document.getElementById('formsList');
            
            if (!jurisdiction || !area) {
                formsList.innerHTML = '';
                return;
            }

            const forms = data.jurisdictions[jurisdiction].areas[area].forms;
            
            formsList.innerHTML = forms.map(form => `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold text-lg mb-2">${form.name}</h3>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">${jurisdiction} - ${area}</span>
                        <a href="${form.path.replace('fillable.pdf', 'fill.html')}"
                           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                            Fill Form
                        </a>
                    </div>
                </div>
            `).join('');
        }

        function displayAllForms(data, searchTerm = '') {
            const formsList = document.getElementById('formsList');
            const allForms = [];
            
            Object.entries(data.jurisdictions).forEach(([jurisdiction, jurisdictionData]) => {
                Object.entries(jurisdictionData.areas).forEach(([area, areaData]) => {
                    areaData.forms.forEach(form => {
                        allForms.push({
                            ...form,
                            jurisdiction,
                            area
                        });
                    });
                });
            });
            
            const filteredForms = searchTerm ? 
                allForms.filter(form => form.name.toLowerCase().includes(searchTerm)) : 
                allForms;
            
            const formsToDisplay = filteredForms.slice(0, 50);
            
            if (formsToDisplay.length === 0) {
                formsList.innerHTML = '<p class="text-gray-600">No forms found matching your search.</p>';
                return;
            }

            formsList.innerHTML = formsToDisplay.map(form => `
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="font-semibold text-lg mb-2">${form.name}</h3>
                    <div class="flex justify-between items-center mt-4">
                        <span class="text-sm text-gray-500">${form.jurisdiction} - ${form.area}</span>
                        <a href="${form.path.replace('fillable.pdf', 'fill.html')}"
                           class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                            Fill Form
                        </a>
                    </div>
                </div>
            `).join('');
        }

        // Load forms when page loads
        document.addEventListener('DOMContentLoaded', loadFormsData);

        let currentFormPath = '';

        function openFormFiller(formPath, formName) {
            currentFormPath = formPath;
            document.getElementById('formName').textContent = formName;
            document.getElementById('pdfViewer').src = formPath;
            document.getElementById('formFillerModal').classList.remove('hidden');
            document.getElementById('chatMessages').innerHTML = `
                <div class="bg-gray-100 rounded-lg p-4">
                    <p class="text-gray-700">Hi! I'll help you fill out the ${formName}. What field would you like to fill first?</p>
                </div>
            `;
        }

        function closeFormFiller() {
            document.getElementById('formFillerModal').classList.add('hidden');
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('userInput').value = '';
        }

        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            if (!message) return;

            // Add user message to chat
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML += `
                <div class="flex justify-end">
                    <div class="bg-blue-600 text-white rounded-lg p-4 max-w-[80%]">
                        <p>${message}</p>
                    </div>
                </div>
            `;

            // Clear input
            userInput.value = '';

            // Simulate AI response (replace with actual API call)
            setTimeout(() => {
                chatMessages.innerHTML += `
                    <div class="bg-gray-100 rounded-lg p-4 max-w-[80%]">
                        <p class="text-gray-700">I'll help you fill that field. Could you please provide the value you'd like to enter?</p>
                    </div>
                `;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        }

        // Handle enter key in input
        document.getElementById('userInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
